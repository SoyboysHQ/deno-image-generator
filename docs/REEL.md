# Instagram Reel Generator

Generate Instagram Reels (vertical videos) from static images with optional background music.

## Overview

The Reel Generator creates 5-second vertical videos (1080x1920, 9:16 aspect ratio) from static images. Perfect for:
- Converting static Instagram posts into Reels
- Creating simple video content from images
- Adding background music to images

## Features

- ✅ **Instagram Reel Format**: 1080x1920 vertical video (9:16 aspect ratio)
- ✅ **Customizable Duration**: Default 5 seconds, configurable
- ✅ **Background Music**: Optional audio support (MP3, WAV, AAC, M4A, OGG)
- ✅ **High Quality**: H.264 codec, 30fps, optimized for social media
- ✅ **Smart Scaling**: Automatically scales and crops images to fit

## API Usage

### Endpoint

`POST /generate-reel`

### Request Body

```json
{
  "imagePath": "assets/images/background.jpeg",
  "audioPath": "assets/audio/music.mp3",
  "duration": 5
}
```

### Parameters

| Parameter | Type | Required | Default | Description |
|-----------|------|----------|---------|-------------|
| `imagePath` | string | ✅ Yes | - | Path to the source image |
| `audioPath` | string | ❌ No | - | Path to background music (optional) |
| `duration` | number | ❌ No | 5 | Video duration in seconds |

### Response

Returns an MP4 video file with the following specifications:
- **Resolution**: 1080x1920 pixels (9:16 aspect ratio)
- **Format**: MP4 (H.264 video codec)
- **Frame Rate**: 30 fps
- **Audio**: AAC codec at 128kbps (if audio provided)
- **Quality**: CRF 23 (high quality)

## Examples

### Basic Reel (No Audio)

```bash
curl -X POST http://localhost:8000/generate-reel \
  -H "Content-Type: application/json" \
  -d '{
    "imagePath": "assets/images/background.jpeg",
    "duration": 5
  }' \
  --output reel.mp4
```

### Reel with Background Music

```bash
curl -X POST http://localhost:8000/generate-reel \
  -H "Content-Type: application/json" \
  -d '{
    "imagePath": "assets/images/background.jpeg",
    "audioPath": "assets/audio/upbeat-music.mp3",
    "duration": 5
  }' \
  --output reel.mp4
```

### Custom Duration

```bash
curl -X POST http://localhost:8000/generate-reel \
  -H "Content-Type: application/json" \
  -d '{
    "imagePath": "assets/images/background.jpeg",
    "duration": 10
  }' \
  --output reel.mp4
```

## Using with Generated Instagram Images

You can use the images generated by the `/generate-image` endpoint as input for reels:

```bash
# Step 1: Generate an Instagram image
curl -X POST http://localhost:8000/generate-image \
  -H "Content-Type: application/json" \
  -d @example_input.json \
  --output generated_image.jpg

# Step 2: Create a reel from that image
curl -X POST http://localhost:8000/generate-reel \
  -H "Content-Type: application/json" \
  -d '{
    "imagePath": "generated_image.jpg",
    "audioPath": "assets/audio/music.mp3",
    "duration": 5
  }' \
  --output reel.mp4
```

## Background Music

### Adding Audio Files

1. Place your audio files in `assets/audio/` directory
2. Reference them in your API requests using relative paths

```json
{
  "imagePath": "assets/images/background.jpeg",
  "audioPath": "assets/audio/your-music.mp3"
}
```

### Supported Audio Formats

- MP3 (`.mp3`)
- WAV (`.wav`)
- AAC (`.aac`)
- M4A (`.m4a`)
- OGG (`.ogg`)

### Finding Royalty-Free Music

Here are some sources for royalty-free music suitable for Instagram Reels:

- **[YouTube Audio Library](https://www.youtube.com/audiolibrary)** - Free music from YouTube
- **[Free Music Archive](https://freemusicarchive.org/)** - Curated free music
- **[Incompetech](https://incompetech.com/music/royalty-free/)** - Kevin MacLeod's music library
- **[Bensound](https://www.bensound.com/)** - Royalty-free music tracks
- **[Pixabay Music](https://pixabay.com/music/)** - Free stock music
- **[Uppbeat](https://uppbeat.io/)** - Free music for creators

### Audio Duration

If your audio file is:
- **Shorter than video duration**: Audio will loop or video will continue silently
- **Longer than video duration**: Audio will be cut at the video length

## Local Testing

### Test the Generator Directly

```bash
./test_reel.sh
```

This will:
1. Check if FFmpeg is installed
2. Generate a reel using the example input
3. Save it as `instagram_reel.mp4`

### Test via Server

```bash
# Terminal 1: Start the server
deno task server

# Terminal 2: Run the test
./test_server_reel.sh
```

## Direct Command Line Usage

You can also run the generator directly:

```bash
deno run --allow-read --allow-write --allow-run \
  src/generators/reel.ts \
  '{"imagePath": "assets/images/background.jpeg", "duration": 5}'
```

## Technical Details

### FFmpeg Command

The generator uses FFmpeg with the following optimizations:

```bash
ffmpeg \
  -loop 1 -i input.jpg \          # Loop the static image
  -i audio.mp3 \                   # Optional: Add audio
  -vf "scale=1080:1920:force_original_aspect_ratio=increase,crop=1080:1920" \
  -c:v libx264 \                   # H.264 codec
  -preset medium \                 # Balance encoding speed/quality
  -tune stillimage \               # Optimize for static images
  -crf 23 \                        # Quality (23 = high quality)
  -pix_fmt yuv420p \              # Compatibility format
  -r 30 \                          # 30 fps
  -t 5 \                           # Duration
  -c:a aac -b:a 128k \            # Audio settings
  -shortest \                      # Match shortest input
  output.mp4
```

### Image Scaling

Images are automatically:
1. Scaled to cover the entire 1080x1920 canvas
2. Cropped from center to maintain aspect ratio
3. No distortion or stretching

## Troubleshooting

### FFmpeg Not Found

**Error**: `FFmpeg command not found`

**Solution**: Install FFmpeg:
- macOS: `brew install ffmpeg`
- Linux: `sudo apt-get install ffmpeg`
- Windows: Download from [ffmpeg.org](https://ffmpeg.org/download.html)

### Invalid Image Path

**Error**: `Failed to load image`

**Solution**: 
- Verify the image path is correct
- Use relative paths from the project root
- Ensure the image file exists and is readable

### Audio Not Playing

**Issue**: Video generates but no audio

**Solution**:
- Verify audio file path is correct
- Check audio file format is supported
- Ensure audio file is not corrupted
- Test audio file with: `ffmpeg -i your-audio.mp3`

### Video Too Large

**Issue**: Generated video file is very large

**Solution**:
- Reduce duration
- Use lower resolution source images
- Adjust CRF value in `src/generators/reel.ts` (higher = smaller file)

### Docker: FFmpeg Issues

**Error**: `FFmpeg not available in container`

**Solution**: Rebuild Docker image with updated Dockerfile:
```bash
docker build -t instagram-generator .
```

The Dockerfile now includes FFmpeg installation.

## n8n Integration

Use the HTTP Request node:

**Configuration:**
- **URL**: `http://your-server:8000/generate-reel`
- **Method**: `POST`
- **Body Content Type**: `JSON`
- **Response Format**: `File`

**Example Body:**
```json
{
  "imagePath": "assets/images/background.jpeg",
  "audioPath": "assets/audio/music.mp3",
  "duration": 5
}
```

## Best Practices

1. **Image Resolution**: Use high-resolution images (at least 1080x1920) for best quality
2. **Audio Length**: Match audio duration to video duration for best results
3. **File Sizes**: Keep audio files under 5MB for faster processing
4. **Testing**: Always test with a short duration first (3-5 seconds)
5. **Aspect Ratio**: Images will be cropped to 9:16 - design accordingly

## Limitations

- Static image only (no animations or transitions)
- Single audio track (no mixing)
- Maximum duration recommended: 60 seconds (for reasonable file sizes)
- Audio must be a file (cannot stream from URL)

## Future Enhancements

Potential features for future versions:
- Ken Burns effect (zoom/pan)
- Multiple images (slideshow)
- Text overlays
- Transitions between images
- Audio mixing/effects
- Custom frame rates

## Examples Gallery

### Use Cases

1. **Quote Cards**: Convert quote images to video format
2. **Tips/Tricks**: Turn list-style images into Reels
3. **Announcements**: Add music to announcement graphics
4. **Portfolio**: Showcase work with background music
5. **Education**: Create educational content with audio narration

## Support

For issues, questions, or feature requests:
1. Check this documentation
2. Review the troubleshooting section
3. Check FFmpeg is properly installed
4. Verify file paths are correct
5. Test with the provided examples first

